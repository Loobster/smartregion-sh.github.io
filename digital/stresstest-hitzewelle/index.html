<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>SH-Engine ‚Äì Digipreis Demo</title>

<link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet"/>
<script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>

<style>
body {
  margin: 0;
  height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  overflow: hidden;
}

/* ================= MAIN ================= */
#main-view {
  position: relative;
  width: 100%;
  height: 100%;
}

#map {
  width: 100%;
  height: 100%;
}

/* ================= INTRO ================= */
#loading-screen {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 3000;
  opacity: 1;
  transition: opacity 1200ms ease;
}

#loading-screen.hidden {
  opacity: 0;
}

.loading-card {
  background: rgba(255,255,255,0.95);
  padding: 26px 34px;
  border-radius: 10px;
  text-align: center;
}

.loading-title {
  font-size: 1.3rem;
  font-weight: 600;
}

.loading-sub {
  font-size: 0.95rem;
  opacity: 0.8;
  margin-bottom: 10px;
}

/* ================= START QUESTION ================= */
#start-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.55);

  display: flex;                 /* IMMER da */
  align-items: center;
  justify-content: center;

  z-index: 2000;

  opacity: 0;                    /* unsichtbar */
  pointer-events: none;          /* nicht klickbar */
  transform: translateY(12px);

  transition:
    opacity 1200ms ease,
    transform 1200ms ease;
}

#start-overlay.visible {
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0);
}

#start-box {
  background: white;
  padding: 22px 32px;
  max-width: 480px;
  text-align: center;
  border-radius: 6px;
}

#start-box h1 {
  font-size: 1.2rem;
  font-weight: normal;
  margin-bottom: 25px;
}

.start-btn {
  width: 100%;
  padding: 12px;
  font-size: 1rem;
  cursor: pointer;
}

/* ================= INFO PANEL ================= */
#info-panel {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 106px;
  padding: 12px 24px;
  box-sizing: border-box;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  background: linear-gradient(
    to top,
    rgba(0,0,0,0.55),
    rgba(0,0,0,0.25),
    rgba(0,0,0,0.05)
  );
  color: #f0f0f0;
  pointer-events: none;
}

#logbox {
  width: 70%;
  font-size: 0.95rem;
  line-height: 1.25;
  transition: transform 1200ms ease-in-out;
}

.logline {
  opacity: 0.9;
color: #655e36;   /*  */
  //color: #ffe8b3;   /* warmes helles Gelb */
  white-space: nowrap;
  overflow: hidden;
}

.pulse {
  animation: pulse 2.5s infinite;
}

@keyframes pulse {
  0% { opacity: 0.6; }
  50% { opacity: 1; }
  100% { opacity: 0.6; }
}

#day-indicator {
  width: 28%;
  text-align: right;
  font-size: 1.6rem;
  font-weight: 300;
  opacity: 0.85;
  padding-right: 16px;
color: #655e36;   /* sehr dunkles Rot, fast Schwarz */
}

/* ================= DEMO OUTRO (NEU) ================= */
#demo-outro {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.55);

  display: flex;
  align-items: center;
  justify-content: center;

  z-index: 2500;

  opacity: 0;
  pointer-events: none;
  transform: translateY(10px);

  transition:
    opacity 1200ms ease,
    transform 1200ms ease;
}

#demo-outro.visible {
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0);
}

#demo-outro .card {
  background: rgba(255,255,255,0.97);
  padding: 26px 30px;
  border-radius: 10px;
  max-width: 600px;
  width: calc(100% - 48px);
  box-shadow: 0 20px 60px rgba(0,0,0,0.35);
}

#demo-outro .title {
  font-size: 1.15rem;
  font-weight: 650;
  margin-bottom: 10px;
}

#demo-outro .text {
  font-size: 1.0rem;
  line-height: 1.35;
  color: rgba(0,0,0,0.85);
}

#demo-outro .hint {
  margin-top: 14px;
  font-size: 0.95rem;
  color: rgba(0,0,0,0.65);
}

#demo-outro .actions {
  margin-top: 18px;
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

#demo-outro button {
  padding: 10px 14px;
  font-size: 1rem;
  cursor: pointer;
}
</style>
</head>

<body>

<!-- INTRO -->
<div id="loading-screen">
  <div class="loading-card">
    <div class="loading-title">üåç Demo SH Engine</div>
    <div class="loading-sub">Zivilgesellschaftliche Open-Source-Initiative</div>
    <div class="loading-sub">Projektleitung: Heinrich Rode</div>
<div style="font-weight:600;">Initialisiere Karte ‚Ä¶</div>
  </div>
</div>

<div id="main-view">
  <div id="map"></div>

  <!-- INFO PANEL -->
  <div id="info-panel">
    <div id="logbox">
      <div class="logline" id="log0"></div>
      <div class="logline" id="log1"></div>
      <div class="logline" id="log2"></div>
      <div class="logline" id="log3"></div>
    </div>
    <div id="day-indicator"></div>
  </div>

  <!-- START QUESTION -->
  <div id="start-overlay">
    <div id="start-box">
      <h1>Was passiert in Kiel, wenn eine extreme Hitzewelle mehrere Tage anh√§lt?</h1>
      <button id="btn-show" class="start-btn">Zeig es mir</button>
    </div>
  </div>

  <!-- DEMO OUTRO (NEU) -->
  <div id="demo-outro">
    <div class="card">
      <div class="title">Hinweis: Das war eine Demo.</div>
      <div class="text">
        Diese Digipreis-Demo arbeitet mit bewusst <b>starren, vorformulierten Meldungen</b>, um das
        <b>Systemverhalten</b> in wenigen Minuten erfahrbar zu machen.<br><br>
        Die echte <b>SH-Engine</b> ist kein ‚ÄûStoryboard‚Äú: Sie verbindet Karten-Layer, reale Daten und
        Szenarien, um <b>Abh√§ngigkeiten</b>, <b>Kaskaden</b> und <b>Wirkungen</b> im Gesamtsystem sichtbar zu machen.
      </div>
      <div class="hint">Schlie√üen: Klick oder Return.</div>
      <div class="actions">
        <button id="btn-outro-close">Schlie√üen</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ================= MAP ================= */
const map = new maplibregl.Map({
  container: "map",
  style: {
    version: 8,
    sources: {},
    layers: [{
      id: "background",
      type: "background",
      /* Sommer-Farbton hier (du hast das bereits gesetzt) */
      paint: { "background-color": "#ffffff" }
    }]
  },
  center: [10.1228, 54.3233],
  zoom: 9.5
});

map.on("load", () => {
  map.addSource("kiel", {
    type: "geojson",
    //data: "kiel_gesamt.geojson"
     data: "assets/kiel_outline1.geojson"
  });

  map.addLayer({
    id: "kiel-heat",
    type: "fill",
    source: "kiel",
    paint: {
      "fill-color": "#ffe0b2",
      "fill-opacity": 0.75
    }
  });
});

/* ================= HEAT LEVEL ================= */
function setHeatLevel(day) {
  /* feinere Abstufung (du hast sie bereits passend) */
  let color = "#fff3c2";         // Tag 1 (sichtbar anders als Start)
  if (day >= 2) color = "#ffe09a";
  if (day >= 3) color = "#ffcb74";
  if (day >= 4) color = "#ffb15f";
  if (day >= 5) color = "#ff8a65";
  if (day >= 6) color = "#ef5350";
  if (day >= 8) color = "#e53935";
  if (day >= 10) color = "#c62828";
  if (day >= 12) color = "#b71c1c";

  if (map.getLayer("kiel-heat")) {
    map.setPaintProperty("kiel-heat", "fill-color", color);
  }
}

function startHeatDemo() {
  const STEP = 5500;
  let t = 0;

  // TAG 1
  setDay(1);
  pushLog("Tag 1: Tagesh√∂chstwerte √ºber 38 ¬∞C");

  // TAG 2
  t += STEP;
  setTimeout(() => {
    setDay(2);
    pushLog("Tag 2: Alltag ‚Äì erste Einschr√§nkungen in Stadt & Betrieben");
  }, t);

  // TAG 3
  t += STEP;
  setTimeout(() => {
    setDay(3);
    pushLog("Tag 3: Gesundheit ‚Äì Kreislaufprobleme nehmen deutlich zu");
  }, t);

  // TAG 4
  t += STEP;
  setTimeout(() => {
    setDay(4);
    pushLog("Tag 4: Regeln ‚Äì Arbeit im Freien wird eingeschr√§nkt");
  }, t);

t += STEP;
  setTimeout(()=>{ setDay(5); pushLog("Tag 5 ‚Äì Regeln: Wasser sparen ‚Äì Bew√§sserung/Rasen verboten"); }, t);

  t += STEP;
  setTimeout(()=>{ setDay(6); pushLog("Tag 6 ‚Äì Regeln: Stadtbetrieb reduziert (Events/√∂ffentliche Orte)"); }, t);

  t += STEP;
  setTimeout(()=>{ setDay(7); pushLog("Tag 7 ‚Äì Infrastruktur: Wasser- & Stromlast steigen (K√ºhlung)"); }, t);

  t += STEP;
  setTimeout(()=>{ setDay(8); pushLog("Tag 8 ‚Äì Stadt: Klimatisierte Orte werden √ºberf√ºllt"); }, t);

  t += STEP;
  setTimeout(()=>{ setDay(9); pushLog("Tag 9 ‚Äì Risiko: Ausf√§lle in Teilbereichen werden wahrscheinlicher", true); }, t);

  t += STEP;
  setTimeout(()=>{ setDay(10); pushLog("Tag 10 ‚Äì Gesundheit: Kliniken & Pflege am Limit"); }, t);

  t += STEP;
  setTimeout(()=>{ setDay(11); pushLog("Tag 11 ‚Äì Sterblichkeit: Hitzefolgen nehmen sp√ºrbar zu"); }, t);

  t += STEP;
  setTimeout(()=>{ setDay(12); pushLog("Tag 12 ‚Äì Fazit: Hitze ist ein systemischer Stresstest der Stadt", true); }, t);

  /* DEMO-OUTRO: wird am Ende weich eingeblendet (Zeitschema bleibt stabil) */
  setTimeout(() => {
    showOutro();
  }, t + STEP);
}

/* ================= INTRO ‚Üí FRAGE ================= */
window.addEventListener("load", () => {
  setTimeout(() => {
    const intro = document.getElementById("loading-screen");
    intro.classList.add("hidden");

    setTimeout(() => {
      intro.remove();
      const start = document.getElementById("start-overlay");
      start.classList.add("visible");
    }, 1300);

  }, 2000);
});

/* ================= DEMO (LOG) ================= */
const logLines = ["", "", "", ""];

function renderLog() {
  logLines.forEach((t, i) => {
    const el = document.getElementById("log" + i);
    el.textContent = t;
    el.classList.remove("pulse");
  });
}

function pushLog(text, pulse=false) {
  const box = document.getElementById("logbox");
  box.style.transform = "translateY(-12px)";
  setTimeout(() => {
    logLines.shift();
    logLines.push(text);
    renderLog();
    if (pulse) document.getElementById("log3").classList.add("pulse");
    box.style.transform = "translateY(0)";
  }, 600);
}

function setDay(day) {
  document.getElementById("day-indicator").textContent =
    "Tag " + day + " der Hitzewelle";
  setHeatLevel(day);
}

/* ================= START: Button + Return ================= */
function startDemoFromQuestion() {
  const start = document.getElementById("start-overlay");

  // 1) sanft ausblenden
  start.classList.remove("visible");

  // 2) Demo ERST NACH dem Ausblenden starten
  setTimeout(() => {
    startHeatDemo();
  }, 1200);
}

document.getElementById("btn-show").addEventListener("click", startDemoFromQuestion);

document.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    const start = document.getElementById("start-overlay");
    if (start.classList.contains("visible")) {
      e.preventDefault();
      startDemoFromQuestion();
    } else {
      const outro = document.getElementById("demo-outro");
      if (outro.classList.contains("visible")) {
        e.preventDefault();
        hideOutro();
      }
    }
  }
});

/* ================= OUTRO: show/hide ================= */
function showOutro() {
  const outro = document.getElementById("demo-outro");
  outro.classList.add("visible");
}

function hideOutro() {
  const outro = document.getElementById("demo-outro");
  outro.classList.remove("visible");
}

document.getElementById("btn-outro-close").addEventListener("click", hideOutro);

/* Klick au√üerhalb der Karte (Overlay) schlie√üt ebenfalls */
document.getElementById("demo-outro").addEventListener("click", (e) => {
  if (e.target.id === "demo-outro") hideOutro();
});
</script>

</body>
B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
A
</html>
